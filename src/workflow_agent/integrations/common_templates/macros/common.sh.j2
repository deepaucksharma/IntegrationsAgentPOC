{# Common logging macro #}
{% macro log_message(level, message) -%}
echo "[`date +'%Y-%m-%d %H:%M:%S'`] [{{ level }}] {{ message }}"
{%- endmacro %}

{# Error handling macro #}
{% macro handle_error(cmd, message) -%}
{{ cmd }} || { echo "[`date +'%Y-%m-%d %H:%M:%S'`] [ERROR] {{ message }}"; exit 1; }
{%- endmacro %}

{# Common shell script macros #}
{% macro setup_logging() %}
# Set up logging
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1"
}

log_info() {
    log "INFO: $1"
}

log_error() {
    log "ERROR: $1" >&2
}

log_debug() {
    if [ "${DEBUG:-0}" = "1" ]; then
        log "DEBUG: $1"
    fi
}
{% endmacro %}

{% macro error_handling() %}
# Error handling
set -e
trap 'log_error "Command failed with exit code $? at line $LINENO"' ERR
{% endmacro %}

{% macro check_prerequisites() %}
# Check prerequisites
check_command() {
    if ! command -v "$1" >/dev/null 2>&1; then
        log_error "Required command not found: $1"
        return 1
    fi
}
{% endmacro %}