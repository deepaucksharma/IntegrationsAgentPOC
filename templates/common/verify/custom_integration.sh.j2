#!/bin/bash
# Custom Integration Verification Script
# Generated by New Relic Integration Agent

# Import common functions
{% include 'macros/common.sh.j2' %}

{{ log_message('INFO', 'Starting verification of custom integration') }}

# Set error handling
set -e

# Check if integration files exist
INSTALL_DIR="{{ parameters.install_dir | default('/opt/custom-integration') }}"
if [ ! -d "$INSTALL_DIR" ]; then
    {{ handle_error('Installation directory not found') }}
fi

# Check configuration
CONFIG_DIR="{{ parameters.config_path | default('/etc/custom-integration') }}"
if [ ! -d "$CONFIG_DIR" ]; then
    {{ handle_error('Configuration directory not found') }}
fi

# Check if config file exists
CONFIG_FILE="$CONFIG_DIR/custom-integration-config.yml"
if [ ! -f "$CONFIG_FILE" ]; then
    {{ handle_error('Configuration file not found') }}
fi

# Verify version
VERSION=$(grep "version:" "$CONFIG_FILE" | cut -d: -f2 | tr -d ' ')
if [ "$VERSION" != "{{ template_data.version }}" ]; then
    {{ handle_error('Version mismatch') }}
fi

{{ log_message('INFO', 'Custom integration verification completed successfully') }}
exit 0 